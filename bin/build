#!/bin/bash

rm -rf heroku-*.tgz

docker build -t tailscale-buildpack:latest .
docker run --rm -it -d --name=tailscale-buildpack-1 tailscale-buildpack:latest

for v in 22 20 18; do
  stack="heroku-${v}"
  mkdir -p "./$stack"

  docker cp tailscale-buildpack-1:${stack}/tailscale ./${stack}/tailscale
  docker cp tailscale-buildpack-1:${stack}/tailscaled ./${stack}/tailscaled

  cd "${stack}"
  tar czfv "../${stack}.tgz" "."
  cd ..

  rm -rf "./${stack}"
done

docker stop tailscale-buildpack-1
